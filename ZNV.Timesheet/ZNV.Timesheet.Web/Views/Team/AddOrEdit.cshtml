@model ZNV.Timesheet.Team.Team
@{
    Layout = null;
}


@using (Html.BeginForm("AddOrEdit", "Team", FormMethod.Post, new { onsubmit = "return SubmitForm(this)" }))
{
    @Html.HiddenFor(model => model.Id)
    <div class="form-group">
        @Html.LabelFor(model => model.TeamName, "科室名称", new { @class = "control-label" })
        @Html.EditorFor(model => model.TeamName, new { htmlAttributes = new { @class = "form-control" } })
        @Html.ValidationMessageFor(model => model.TeamName, "", new { @class = "text-danger"})
    </div>
    <div class="form-group">
        @Html.LabelFor(model => model.TeamLeader, "科室领导", new { @class = "control-label" })
        @Html.DropDownListFor(model => model.TeamLeader, (IEnumerable<SelectListItem>)ViewBag.Employees, String.Empty, new { id = "leader", @class = "form-control select2" })
        @Html.ValidationMessageFor(model => model.TeamLeader, "", new { @class = "text-danger" })
    </div>
    <div class="form-group">
        @Html.LabelFor(model => model.DepartmentID, "所属部门", new { @class = "control-label" })
        @Html.DropDownListFor(model => model.DepartmentID, (IEnumerable<SelectListItem>)ViewBag.Departments, String.Empty, new { id = "dept", @class = "form-control select2" })
        @Html.ValidationMessageFor(model => model.DepartmentID, "", new { @class = "text-danger" })
    </div>
    <div class="form-group pull-right">
        <input type="submit" value="保存" class="btn btn-primary btn-lg" />
    </div>
}

<script>
    $(document).ready(function () {
        $('#leader').select2(
            {
                placeholder: '输入工号或名字',
                //Does the user have to enter any data before sending the ajax request
                minimumInputLength: 0,
                allowClear: false,
                ajax: {
                    //How long the user has to pause their typing before sending the next request
                    delay: 150,
                    //The url of the json service
                    url: '@Url.Action("GetEmployeeList", "Team")',
                    dataType: 'json',
                    async: true,
                    //Our search term and what page we are on
                    data: function (params) {
                        return {
                            pageSize: 100,
                            pageNum: params.page || 1,
                            searchTerm: params.term,
                        };
                    },
                    processResults: function (data, params) {
                        params.page = params.page || 1;
                        return {
                            results: $.map(data.Results, function (obj) {
                                return { id: obj.EmployeeCode, text: obj.EmployeeName + "(" + obj.EmployeeCode + ")" };
                            }),
                            pagination: {
                                more: (params.page * 100) <= data.Total
                            }
                        };
                    }
                }
            });

        $('#dept').select2(
            {
                placeholder: '输入部门编码或名称',
                //Does the user have to enter any data before sending the ajax request
                minimumInputLength: 0,
                allowClear: false,
                ajax: {
                    //How long the user has to pause their typing before sending the next request
                    delay: 150,
                    //The url of the json service
                    url: '@Url.Action("GetDepartmentList", "Team")',
                    dataType: 'json',
                    async: true,
                    //Our search term and what page we are on
                    data: function (params) {
                        return {
                            pageSize: 100,
                            pageNum: params.page || 1,
                            searchTerm: params.term,
                        };
                    },
                    processResults: function (data, params) {
                        params.page = params.page || 1;
                        return {
                            results: $.map(data.Results, function (obj) {
                                return { id: obj.DeptCode1, text: obj.FullDeptName + "(" + obj.DeptCode1 + ")" };
                            }),
                            pagination: {
                                more: (params.page * 100) <= data.Total
                            }
                        };
                    }
                }
            });
    });

    
</script>


